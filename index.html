<!DOCTYPE html>
<html lang="en">

<main>
  <h2>A Simple Fetch API Example</h2>
  <p>Use the button below to 'fetch' content from an external location via the Fetch API. The content will be displayed below:</p>
  <p class="par"></p>
   <button id="btn1">Get content</button>
	<input type="button" id="btn5" value="Get Content" />

</main>

<body>
	<h2>Below are the 2 ID's I need</h2>
	
	<div id="re1"></div>
	<div id="re2"></div>
	<br>
	
	<input type="button" id="btn2" value="Send DTMF" />	

 <script>



function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\#&]" + name + "=([^&#]*)"),
          results = regex.exec(location.hash);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }
if(window.location.hash) {
        console.log(location.hash);
        var token = getParameterByName('access_token');
} 
console.log(token)

	// const url = "https://api.mypurecloud.com.au/api/v2/users/me";


	var url = "https://api.mypurecloud.com.au/api/v2/conversations/calls";
	var id1 =""
	var id2 =""
	var url2 = ""	


	const myHeaders = new Headers();
	myHeaders.append('Content-Type', 'application/json');
	myHeaders.append('Authorization', 'bearer ' + token);

	  
document.getElementById('btn1').addEventListener('click', function () {
	let obj = fetch(url, {
		method: 'GET',
		// credentials: 'include',
		// mode: 'no-cors',
		origin: 'https://kelvinlow39.github.io/CCPTest',
		headers: myHeaders,
		})
		.then(response => response.json())
		.then(data => {
			//console.log(data)
			//console.log(data.entities[0].id)
			id1 = data.entities[0].id
			id2 = data.entities[0].participants[3].id
			document.querySelector("#re1").innerText = id1
			document.querySelector("#re2").innerText = id2
			//console.log(id1)
			//console.log(id2)
			var url2 = "https://api.mypurecloud.com.au/api/v2/conversations/" + id1 + "/participants/" + id2 +"/digits";
			//const url3 = url2
			//console.log(url2)
			
			
		})
		.catch(err => console.log('Request Failed')); 
	

	
	}, false);




//var url2 = "https://api.mypurecloud.com.au/api/v2/conversations/" + id1 + "/participants/" + id2 +"/digits";
//console.log(url2)

document.getElementById('btn2').addEventListener('click', function () {
	console.log("start")
	console.log(id1)
	console.log(id2)
	url2 = "https://api.mypurecloud.com.au/api/v2/conversations/" + id1 + "/participants/" + id2 +"/digits"
	let obj = fetch(url2, {
		method: 'POST',
		body: '{"digits": "92918"}',
		origin: 'http://127.0.0.1:8080',
		headers: myHeaders,
		})
		.then(response => response.json())
		.then(data => console.log(data))
		.catch(err => console.log('Request Failed')); 
	}, false);










  
  </script>
</body>

</html>
