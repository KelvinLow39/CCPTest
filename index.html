<!DOCTYPE html>
<html lang="en">


<main>
  <h2>A Simple Fetch API Example</h2>
  <p>Use the button below to 'fetch' content from an external location via the Fetch API. The content will be displayed below:</p>
  <p class="par"></p>
	<button>Get Content</button>
</main>

<body>
 <script>

function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\#&]" + name + "=([^&#]*)"),
          results = regex.exec(location.hash);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }
if(window.location.hash) {
        console.log(location.hash);
        var token = getParameterByName('access_token');
} 
console.log(token)
	
	const url = "https://api.mypurecloud.com.au/api/v2/conversations/calls";
	// const url = "https://api.mypurecloud.com.au/api/v2/users/me";
	const myHeaders = new Headers();
	myHeaders.append('Content-Type', 'application/json');
	myHeaders.append('Authorization', 'bearer ' + token);

	  
document.querySelector('button').addEventListener('click', function () {
	let response = fetch(url, {
		method: 'GET',
		// credentials: 'include',
		// mode: 'no-cors',
		origin: 'https://kelvinlow39.github.io/CCPTest',
		headers: myHeaders,
		})
		.then(response => response.json())
		.then(json => console.log(json))
		.catch(err => console.log('Request Failed')); 
	
	var obj = JSON.parse(response);
	document.write("Conv ID" + "<br>");
	document.write(obj["entities"][0]["id"]+ "<br>");
	document.write(obj["entities"][0]["participants"][3]["id"] + "<br>");
	
	}, false);
  
  </script>
</body>

</html>
